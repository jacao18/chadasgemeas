<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Confirmar presen√ßa - Clara e Marina</title>

    <!-- Linha para adicionar o Favicon (√≠cone de cora√ß√£o de copas) -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Link para a fonte Poppins do Google Fonts para um visual moderno -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK - Adicione estes links -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

    <style>
        /* Definindo a paleta de cores como vari√°veis CSS */
        :root {
            --palette-pink: #FFCCCC; /* Rosa Claro */
            --palette-peach: #FFDEAD; /* P√™ssego */
            --palette-yellow: #FFFFCC; /* Amarelo Claro */
            --palette-mint: #CCFFE6; /* Verde Menta */
            --palette-blue: #CCE0FF; /* Azul Claro */

            /* Cores derivadas para acentos e texto */
            --color-background-soft: var(--palette-mint); /* Fundo principal da p√°gina */
            --color-section-background: var(--palette-blue); /* Fundo de se√ß√µes como hero */
            --color-card-background: #FFFFFF; /* Branco para cart√µes e modais */

            --color-primary-accent: #FF99B3; /* Rosa mais forte para bot√µes, pre√ßos, √¢nforas */
            --color-primary-accent-hover: #FF809F; /* Rosa mais escuro para hover */
            --color-secondary-accent: var(--palette-yellow); /* Fundo de controles de ordena√ß√£o, instru√ß√µes de pagamento */

            --color-border-light: var(--palette-blue); /* Bordas e linhas finas */
            --color-placeholder-image: var(--palette-peach); /* Cor para placeholders de imagem */

            --color-text-dark: #333; /* Texto principal escuro para legibilidade */
            --color-text-medium: #666; /* Texto secund√°rio/sutil */
            --color-text-light: #FDFDFD; /* Texto para fundos escuros (quase branco) */
        }

        /* Estilos b√°sicos para o corpo e reset de margens/padding */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--palette-peach); /* Pesesgo*/
            color: var(--color-text-dark); /* Cor de texto principal escura para legibilidade */
            line-height: 1.6;
        }

        /* Container para centralizar o conte√∫do */
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Estilo do Cabe√ßalho */
        header {
            background-image: url('fundo.jpg'); /* Caminho para sua imagem */
            background-size: cover; /* Faz a imagem cobrir toda a √°rea do header */
            background-position: center center; /* Centraliza a imagem */
            background-repeat: no-repeat; /* Evita que a imagem se repita */
            padding: 20px 0 10px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(204,224,255,0.3); /* Sombra suave do azul claro */
            margin-bottom: 20px;
        }

        header h1 {
            color: var(--color-primary-accent); /* Rosa Acento */
            margin: 0 0 15px 0;
            font-size: 1.8em;
        }

        /* Estilo do Menu de Navega√ß√£o */
        nav ul {
            list-style: none; /* Remove marcadores da lista */
            padding: 0;
            margin: 0;
            display: flex; /* Itens em linha */
            justify-content: center; /* Centraliza os itens */
            gap: 25px; /* Espa√ßamento entre os itens do menu */
            flex-wrap: wrap; /* Quebra linha se a tela for muito pequena */
            background-color: var(--palette-peach); /* NOVO: Fundo p√™ssego para o menu */
            padding: 10px 0; /* Adiciona um pouco de padding para o fundo p√™ssego aparecer */
            border-radius: 8px; /* Opcional: Adiciona bordas arredondadas ao menu */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Opcional: Adiciona uma sombra suave */
        }

        nav ul li a {
            text-decoration: none; /* Remove sublinhado */
            color: var(--color-primary-accent); /* Rosa Acento */
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        nav ul li a:hover {
            background-color: var(--palette-pink); /* Rosa Clar√≠ssimo */
            color: var(--color-primary-accent-hover); /* Rosa Acento Hover */
        }

        /* Estilos para a Se√ß√£o de Confirma√ß√£o de Presen√ßa */
        .rsvp-section {
            background-color: var(--color-section-background); /* Azul Claro */
            padding: 30px 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(204,224,255,0.2);
            text-align: center;
        }

        .rsvp-section h2 {
            color: var(--color-primary-accent); /* Rosa Acento */
            margin-top: 0;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .rsvp-section img.profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%; /* Imagem redonda */
            object-fit: cover;
            border: 3px solid var(--color-primary-accent); /* Borda rosa acento */
            margin-bottom: 15px;
        }

        .rsvp-form-container {
            background-color: var(--color-card-background); /* Branco puro */
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 500px; /* Limita a largura do formul√°rio */
            margin: 0 auto; /* Centraliza o formul√°rio */
        }

        .rsvp-form-container h3 {
            color: var(--color-text-dark);
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .rsvp-form .form-group {
            margin-bottom: 20px;
            text-align: left; /* Alinha labels e inputs √† esquerda */
        }

        .rsvp-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--color-text-medium);
        }

        .rsvp-form input[type="text"] {
            width: calc(100% - 22px); /* Ajusta para o padding e borda */
            padding: 10px;
            border: 1px solid var(--color-border-light); /* Azul Claro */
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            color: var(--color-text-dark);
            background-color: #fcfcfc;
        }

        .confirm-btn {
            background-color: var(--color-primary-accent); /* Rosa Acento */
            color: var(--color-text-light); /* Branco */
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease;
            width: 100%;
            display: block;
            margin-top: 25px;
        }

        .confirm-btn:hover {
            background-color: var(--color-primary-accent-hover); /* Rosa Acento Hover */
        }

        .confirmation-message, .already-confirmed-message {
            margin-top: 25px;
            padding: 15px;
            background-color: var(--palette-yellow); /* Amarelo Claro */
            border: 1px solid var(--color-border-light);
            border-radius: 8px;
            color: var(--color-text-dark);
            font-weight: 600;
            display: none; /* Escondido por padr√£o */
        }
        .confirmation-message p, .already-confirmed-message p {
            margin: 0;
        }


        /* Rodap√© */
        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            color: var(--color-text-medium);
            font-size: 0.85em;
            border-top: 1px solid var(--color-border-light); /* Borda azul clara */
        }

        /* Ajustes Responsivos para telas menores */
        @media (max-width: 768px) {
            .container {
                margin: 10px auto;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
            }

            .rsvp-form-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Ch√° das g√™meas</h1>
            <h1>Clara e Marina</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Loja de Presentes</a></li>
                    <li><a href="mural.html">Mural de Recados</a></li>
                    <li><a href="confirmar_presenca.html">Confirmar Presen√ßa</a></li>
                    <li><a href="evento.html">Local</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Se√ß√£o de Confirma√ß√£o de Presen√ßa -->
        <section class="rsvp-section">
            <img src="eco.jpg" alt="Ilustra√ß√£o de beb√™ em tema ecol√≥gico" class="profile-pic">
            <h2>üéâ Confirme sua presen√ßa üéâ</h2>
            <p>Confirme sua presen√ßa at√© o dia 15 de Setembro</p>
            <div class="rsvp-form-container">
                <h3>Preencha os dados:</h3>
                <form id="rsvpForm" class="rsvp-form">
                    <div class="form-group">
                        <label for="fullName">Seu nome completo:</label>
                        <input type="text" id="fullName" placeholder="Nome e Sobrenome" required>
                    </div>
                    <div class="form-group">
                        <label for="guests">Acompanhantes:</label>
                        <input type="text" id="guests" placeholder="Ex: +1 adulto, +2 crian√ßas ou N/A (se n√£o houver)">
                        <small style="color: var(--color-text-medium); display: block; margin-top: 5px;">Por favor, informe o n√∫mero de acompanhantes (adultos/crian√ßas) ou "N/A" se for vir sozinho.</small>
                    </div>
                    <button type="submit" class="confirm-btn">Confirmar presen√ßa</button>
                </form>
                <div id="confirmationMessage" class="confirmation-message">
                    <p>‚úÖ Presen√ßa confirmada com sucesso! Muito obrigado(a)!</p>
                </div>
                <div id="alreadyConfirmedMessage" class="already-confirmed-message">
                    <p>üéâüéâ Sua presen√ßa j√° foi confirmada anteriormente. Muito obrigado(a)!</p>
                </div>
                <!-- NOVO: Mensagem de data limite excedida -->
                <div id="deadlinePassedMessage" class="already-confirmed-message" style="display: none;">
                    <p>‚ùå N√£o √© mais poss√≠vel confirmar a presen√ßa pelo site. Por favor notifique diretamente os papais.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Ch√° das g√™meas Clara e Marina. Desenvolvido com carinho.</p>
    </footer>

    <script type="module">
        // Importa as fun√ß√µes necess√°rias do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // SEU OBJETO firebaseConfig - SUBSTITUA POR AQUELE QUE VOC√ä COPIOU DO CONSOLE DO FIREBASE!
        const firebaseConfig = {
          apiKey: "AIzaSyAG0w9X-YaHQoaf8pKMCbPzZMXiNKjp6Ys",
          authDomain: "bd-cha-das-gemeas.firebaseapp.com",
          projectId: "bd-cha-das-gemeas",
          storageBucket: "bd-cha-das-gemeas.firebasestorage.app",
          messagingSenderId: "315225196297",
          appId: "1:315225196297:web:d4e4fb508de590c32135d8"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // Obt√©m a inst√¢ncia do Firestore

        // Fun√ß√£o para obter ou criar um ID de usu√°rio √∫nico no localStorage
        function getOrCreateCurrentUserId() {
            let userId = localStorage.getItem('chaGemeasRsvpUserId'); // ID espec√≠fico para RSVP
            if (!userId) {
                userId = crypto.randomUUID(); 
                localStorage.setItem('chaGemeasRsvpUserId', userId);
                console.log("Novo ID de usu√°rio para RSVP gerado e salvo:", userId);
            } else {
                console.log("Usando ID de usu√°rio existente para RSVP:", userId);
            }
            return userId;
        }

        const currentUserId = getOrCreateCurrentUserId(); // Obt√©m o ID do usu√°rio para esta sess√£o

        document.addEventListener('DOMContentLoaded', function() {
            const rsvpForm = document.getElementById('rsvpForm');
            const fullNameInput = document.getElementById('fullName');
            const guestsInput = document.getElementById('guests');
            const confirmationMessageDiv = document.getElementById('confirmationMessage');
            const alreadyConfirmedMessageDiv = document.getElementById('alreadyConfirmedMessage');
            const deadlinePassedMessageDiv = document.getElementById('deadlinePassedMessage'); // NOVO: Refer√™ncia ao novo div

            // Define a data limite para a confirma√ß√£o (15 de Setembro de 2025)
            // Os meses em JavaScript s√£o baseados em zero (0 para Janeiro, 8 para Setembro)
            const cutoffDate = new Date(2025, 8, 16); 
            const currentDate = new Date(); // Pega a data e hora atual

            // 1. VERIFICA√á√ÉO DA DATA LIMITE
            if (currentDate >= cutoffDate) {
                rsvpForm.style.display = 'none'; // Esconde o formul√°rio
                deadlinePassedMessageDiv.style.display = 'block'; // Mostra a mensagem de data limite excedida
                return; // Impede que o restante do script (e o formul√°rio) seja processado
            }

            // Fun√ß√£o para verificar se a presen√ßa j√° foi confirmada
            async function checkExistingRsvp() {
                try {
                    const rsvpDocRef = doc(db, "rsvps", currentUserId);
                    const docSnap = await getDoc(rsvpDocRef);

                    if (docSnap.exists()) {
                        console.log("Presen√ßa j√° confirmada para este usu√°rio.");
                        rsvpForm.style.display = 'none'; // Esconde o formul√°rio
                        alreadyConfirmedMessageDiv.style.display = 'block'; // Mostra a mensagem de j√° confirmado
                        return true;
                    }
                    return false;
                } catch (e) {
                    console.error("Erro ao verificar confirma√ß√£o existente: ", e);
                    // Em caso de erro, por seguran√ßa, permite o envio para evitar bloqueio indevido
                    return false; 
                }
            }

            // Fun√ß√£o para adicionar a confirma√ß√£o ao Firestore
            async function addRsvpToFirestore(fullName, guests) {
                try {
                    // Usa setDoc com o userId como ID do documento para garantir unicidade
                    await setDoc(doc(db, "rsvps", currentUserId), {
                        userId: currentUserId, // Guarda o userId tamb√©m como um campo
                        fullName: fullName,
                        guests: guests,
                        timestamp: new Date() // Armazena a data e hora da confirma√ß√£o
                    });
                    console.log("Presen√ßa confirmada e salva no Firestore!");
                    return true;
                } catch (e) {
                    console.error("Erro ao salvar confirma√ß√£o: ", e);
                    alert("Erro ao confirmar presen√ßa. Tente novamente! Verifique o console para mais detalhes.");
                    return false;
                }
            }

            // Event listener para o envio do formul√°rio de RSVP
            rsvpForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // Previne o envio padr√£o do formul√°rio

                const fullName = fullNameInput.value.trim();
                const guests = guestsInput.value.trim() || "N/A"; // Se acompanhantes vazio, coloca N/A

                if (fullName) {
                    // Verifica novamente antes de enviar (redundante com a verifica√ß√£o inicial, mas seguro)
                    if (await checkExistingRsvp()) {
                        return; // J√° confirmou, n√£o faz nada
                    }

                    // Tenta salvar no Firebase Firestore
                    const success = await addRsvpToFirestore(fullName, guests);

                    if (success) {
                        // Esconde o formul√°rio e mostra a mensagem de sucesso
                        rsvpForm.style.display = 'none'; 
                        confirmationMessageDiv.style.display = 'block'; 
                    }
                } else {
                    alert('Por favor, preencha seu nome completo.');
                }
            });

            // Chama a verifica√ß√£o inicial ao carregar a p√°gina
            checkExistingRsvp();
        });
    </script>
</body>
</html>
