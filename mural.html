<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mural de Recados - Clara e Marina</title>

    <!-- Linha para adicionar o Favicon (√≠cone de cora√ß√£o de copas) -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Link para a fonte Poppins do Google Fonts para um visual moderno -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDK - Adicione estes links -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

    <style>
        /* Definindo a paleta de cores como vari√°veis CSS */
        :root {
            --palette-pink: #FFCCCC; /* Rosa Claro */
            --palette-peach: #FFDEAD; /* P√™ssego */
            --palette-yellow: #FFFFCC; /* Amarelo Claro */
            --palette-mint: #CCFFE6; /* Verde Menta */
            --palette-blue: #CCE0FF; /* Azul Claro */

            /* Cores derivadas para acentos e texto */
            --color-background-soft: var(--palette-mint); /* Fundo principal da p√°gina */
            --color-section-background: var(--palette-blue); /* Fundo de se√ß√µes como hero */
            --color-card-background: #FFFFFF; /* Branco para cart√µes e modais */

            --color-primary-accent: #FF99B3; /* Rosa mais forte para bot√µes, pre√ßos, √¢nforas */
            --color-primary-accent-hover: #FF809F; /* Rosa mais escuro para hover */
            --color-secondary-accent: var(--palette-yellow); /* Fundo de controles de ordena√ß√£o, instru√ß√µes de pagamento */

            --color-border-light: var(--palette-blue); /* Bordas e linhas finas */
            --color-placeholder-image: var(--palette-peach); /* Cor para placeholders de imagem */

            --color-text-dark: #333; /* Texto principal escuro para legibilidade */
            --color-text-medium: #666; /* Texto secund√°rio/sutil */
            --color-text-light: #FDFDFD; /* Texto para fundos escuros (quase branco) */
        }

        /* Estilos b√°sicos para o corpo e reset de margens/padding */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-background-soft); /* Verde Menta */
            color: var(--color-text-dark); /* Cor de texto principal escura para legibilidade */
            line-height: 1.6;
        }

        /* Container para centralizar o conte√∫do */
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Estilo do Cabe√ßalho */
        header {
            background-color: var(--color-card-background); /* Branco puro */
            padding: 20px 0 10px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(204,224,255,0.3); /* Sombra suave do azul claro */
            margin-bottom: 20px;
        }

        header h1 {
            color: var(--color-primary-accent); /* Rosa Acento */
            margin: 0 0 15px 0;
            font-size: 1.8em;
        }

        /* Estilo do Menu de Navega√ß√£o */
        nav ul {
            list-style: none; /* Remove marcadores da lista */
            padding: 0;
            margin: 0;
            display: flex; /* Itens em linha */
            justify-content: center; /* Centraliza os itens */
            gap: 25px; /* Espa√ßamento entre os itens do menu */
            flex-wrap: wrap; /* Quebra linha se a tela for muito pequena */
        }

        nav ul li a {
            text-decoration: none; /* Remove sublinhado */
            color: var(--color-primary-accent); /* Rosa Acento */
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        nav ul li a:hover {
            background-color: var(--palette-pink); /* Rosa Clar√≠ssimo */
            color: var(--color-primary-accent-hover); /* Rosa Acento Hover */
        }

        /* Estilos para Mural de Recados */
        .mural-section {
            background-color: var(--color-section-background); /* Azul Claro */
            padding: 30px 20px;
            border-radius: 8px;
            margin-top: 20px;
            box-shadow: 0 2px 8px rgba(204,224,255,0.2);
        }

        .mural-section h2 {
            text-align: center;
            color: var(--color-primary-accent); /* Rosa Acento */
            margin-top: 0;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .mural-form-container, .mural-messages-container {
            background-color: var(--color-card-background); /* Branco puro */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .mural-form-container h3, .mural-messages-container h3 {
            color: var(--color-text-dark);
            margin-top: 0;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3em;
        }

        .message-form .form-group {
            margin-bottom: 15px;
        }

        .message-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--color-text-medium);
        }

        .message-form input[type="text"],
        .message-form textarea {
            width: calc(100% - 20px); /* Ajusta para o padding */
            padding: 10px;
            border: 1px solid var(--color-border-light); /* Azul Claro */
            border-radius: 5px;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            color: var(--color-text-dark);
            background-color: #fcfcfc;
        }

        .message-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        .submit-message-btn {
            background-color: var(--color-primary-accent); /* Rosa Acento */
            color: var(--color-text-light); /* Branco */
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease;
            width: 100%;
            display: block;
        }

        .submit-message-btn:hover {
            background-color: var(--color-primary-accent-hover); /* Rosa Acento Hover */
        }

        .messages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px; /* Espa√ßamento entre os cart√µes de mensagem */
        }

        .message-card {
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border: 1px solid var(--color-border-light); /* Azul Claro */
            position: relative; /* Para posicionar o bot√£o de excluir */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Cores de fundo alternativas para os cart√µes de mensagem */
        .message-card.color-0 { background-color: var(--palette-pink); }
        .message-card.color-1 { background-color: var(--palette-peach); }
        .message-card.color-2 { background-color: var(--palette-yellow); }
        .message-card.color-3 { background-color: var(--palette-mint); }
        .message-card.color-4 { background-color: var(--palette-blue); }


        .message-card .message-author {
            font-weight: 700;
            color: var(--color-primary-accent); /* Rosa Acento */
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .message-card .message-text {
            color: var(--color-text-dark);
            font-size: 0.95em;
            margin-bottom: 10px;
            flex-grow: 1; /* Permite que o texto ocupe espa√ßo restante */
        }

        .message-card .message-date {
            font-size: 0.8em;
            color: var(--color-text-medium);
            text-align: right;
            border-top: 1px dashed var(--color-border-light);
            padding-top: 8px;
            margin-top: 8px;
        }

        .delete-message-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: var(--color-text-medium);
            font-size: 1.2em;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }
        .delete-message-btn:hover {
            color: var(--color-primary-accent); /* Rosa Acento */
        }

        /* Rodap√© */
        footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            color: var(--color-text-medium);
            font-size: 0.85em;
            border-top: 1px solid var(--color-border-light); /* Borda azul clara */
        }

        /* Ajustes Responsivos para telas menores */
        @media (max-width: 768px) {
            .container {
                margin: 10px auto;
            }

            nav ul {
                flex-direction: column;
                gap: 10px;
            }
             /* Ajustes Responsivos para a se√ß√£o do Mural */
            .messages-grid {
                grid-template-columns: 1fr; /* Mensagens empilhadas em telas pequenas */
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Ch√° das g√™meas</h1>
            <h1>Clara e Marina</h1>
            <nav>
                <ul>
                    <li><a href="index.html">Lista de Presentes</a></li>
                    <li><a href="mural.html">Mural de Recados</a></li>
                    <li><a href="#presenca">Confirmar Presen√ßa</a></li>
                    <li><a href="#evento">Evento</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <!-- Se√ß√£o do Mural de Recados -->
        <section id="mural" class="mural-section">
            <h2>üíû Deixe seu Carinho para Clara e Marina! üíû</h2>
            <div class="mural-form-container">
                <h3>Escreva sua Mensagem:</h3>
                <form id="messageForm" class="message-form">
                    <div class="form-group">
                        <label for="authorName">Seu Nome:</label>
                        <input type="text" id="authorName" placeholder="Seu nome ou apelido" required>
                    </div>
                    <div class="form-group">
                        <label for="messageText">Sua Mensagem:</label>
                        <textarea id="messageText" placeholder="Parab√©ns e muitas felicidades!" required></textarea>
                    </div>
                    <button type="submit" class="submit-message-btn">Enviar Mensagem</button>
                </form>
            </div>

            <div class="mural-messages-container">
                <h3>Mensagens de Carinho:</h3>
                <div id="messagesList" class="messages-grid">
                    <!-- As mensagens ser√£o carregadas aqui pelo JavaScript -->
                    <p class="no-messages-yet" style="text-align: center; color: var(--color-text-medium); display: none;">Ainda n√£o h√° mensagens. Seja o primeiro a deixar uma!</p>
                </div>
            </div>
        </section>
        <!-- FIM da Se√ß√£o do Mural de Recados -->
    </main>

    <footer>
        <p>&copy; 2025 Ch√° das g√™meas Clara e Marina. Desenvolvido com carinho.</p>
    </footer>

    <script type="module">
        // Importa as fun√ß√µes necess√°rias do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, orderBy, query, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // SEU OBJETO firebaseConfig - SUBSTITUA POR AQUELE QUE VOC√ä COPIOU DO CONSOLE DO FIREBASE!
        const firebaseConfig = {
             apiKey: "SUA_API_KEY",
             authDomain: "SEU_AUTH_DOMAIN",
             projectId: "SEU_PROJECT_ID",
             storageBucket: "SEU_STORAGE_BUCKET",
             messagingSenderId: "SEU_MESSAGING_SENDER_ID",
             appId: "SEU_APP_ID"
        };

        // Inicializa o Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app); // Obt√©m a inst√¢ncia do Firestore

        document.addEventListener('DOMContentLoaded', function() {
            const messageForm = document.getElementById('messageForm');
            const authorNameInput = document.getElementById('authorName');
            const messageTextInput = document.getElementById('messageText');
            const messagesListDiv = document.getElementById('messagesList');
            const noMessagesYet = messagesListDiv.querySelector('.no-messages-yet'); 
            
            // Array de cores para alternar o fundo dos cart√µes de mensagem
            const messageCardColors = [
                'color-0', // var(--palette-pink)
                'color-1', // var(--palette-peach)
                'color-2', // var(--palette-yellow)
                'color-3', // var(--palette-mint)
                'color-4'  // var(--palette-blue)
            ];

            // Fun√ß√£o para formatar a data de exibi√ß√£o
            function formatDate(timestamp) {
                // Firebase timestamp √© um objeto com toDate()
                const date = timestamp.toDate(); 
                const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                return date.toLocaleDateString('pt-BR', options);
            }

            // --- FUN√á√ïES DO FIREBASE ---

            // 1. Adicionar mensagem ao Firestore
            async function addMessageToFirestore(author, text) {
                try {
                    // Adiciona um novo documento √† cole√ß√£o 'messages'
                    // O ID do documento √© gerado automaticamente pelo Firestore
                    await addDoc(collection(db, "messages"), {
                        author: author,
                        text: text,
                        date: new Date() // Armazena um objeto Date nativo do JavaScript
                    });
                    console.log("Mensagem adicionada com sucesso!");
                } catch (e) {
                    console.error("Erro ao adicionar documento: ", e);
                    alert("Erro ao enviar mensagem. Tente novamente!");
                }
            }

            // 2. Escutar por mensagens em tempo real do Firestore e renderiz√°-las
            function listenForMessages() {
                // Cria uma consulta para a cole√ß√£o 'messages', ordenada por data (mais recente primeiro)
                const q = query(collection(db, "messages"), orderBy("date", "desc"));

                // onSnapshot escuta em tempo real por mudan√ßas na cole√ß√£o
                onSnapshot(q, (querySnapshot) => {
                    messagesListDiv.innerHTML = ''; // Limpa o container antes de renderizar
                    const messages = [];
                    querySnapshot.forEach((doc) => {
                        // Obt√©m os dados do documento e o ID
                        messages.push({ id: doc.id, ...doc.data() });
                    });

                    if (messages.length === 0) {
                        noMessagesYet.style.display = 'block'; // Mostra o texto "ainda n√£o h√° mensagens"
                    } else {
                        noMessagesYet.style.display = 'none'; // Esconde o texto
                        messages.forEach((msg, index) => {
                            const messageCard = document.createElement('div');
                            // Adiciona a classe de cor alternada
                            messageCard.classList.add('message-card', messageCardColors[index % messageCardColors.length]);
                            
                            messageCard.innerHTML = `
                                <button class="delete-message-btn" data-id="${msg.id}">&times;</button>
                                <p class="message-author">De: ${msg.author}</p>
                                <p class="message-text">${msg.text}</p>
                                <p class="message-date">Em: ${formatDate(msg.date)}</p>
                            `;
                            messagesListDiv.appendChild(messageCard);
                        });

                        // Adiciona listeners para os bot√µes de exclus√£o
                        document.querySelectorAll('.delete-message-btn').forEach(button => {
                            button.addEventListener('click', function() {
                                const messageId = this.dataset.id;
                                if (confirm('Tem certeza que deseja excluir esta mensagem? Ela ser√° removida para todos.')) {
                                    deleteMessageFromFirestore(messageId);
                                }
                            });
                        });
                    }
                });
            }

            // 3. Excluir mensagem do Firestore
            async function deleteMessageFromFirestore(idToDelete) {
                try {
                    // Referencia o documento a ser exclu√≠do
                    await deleteDoc(doc(db, "messages", idToDelete));
                    console.log("Documento exclu√≠do com sucesso!");
                } catch (e) {
                    console.error("Erro ao excluir documento: ", e);
                    alert("Erro ao excluir mensagem. Tente novamente!");
                }
            }
            
            // --- EVENT LISTENERS E INICIALIZA√á√ÉO ---

            // Event listener para envio do formul√°rio do mural
            messageForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // Previne o envio padr√£o do formul√°rio

                const author = authorNameInput.value.trim();
                const text = messageTextInput.value.trim();

                if (author && text) {
                    await addMessageToFirestore(author, text); // Chama a fun√ß√£o Firebase
                    messageForm.reset(); // Limpa o formul√°rio
                    alert('Sua mensagem foi enviada com sucesso! ‚ù§Ô∏è');
                } else {
                    alert('Por favor, preencha seu nome e a mensagem.');
                }
            });

            // Inicia a escuta de mensagens quando a p√°gina carrega
            listenForMessages();
        });
    </script>
</body>
</html>
